---
title: 'Cloudflare Workers ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—'
url: 'https://workshop.yusuke.run/20251028'
imageUrl: 'https://ss.yusukebe.com/44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a_2716x1452.png'
---

# Cloudflare Workers ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—

- Yusuke Wada
- 2025-10-28
- [workshop.yusuke.run](https://workshop.yusuke.run/)

# ã‚¢ã‚¸ã‚§ãƒ³ãƒ€

1. è‡ªå·±ç´¹ä»‹
2. Workers ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³
3. Hono ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³
4. åŸºæœ¬ç·¨
5. ãƒ—ãƒ­ã‚­ã‚·ç·¨
6. Web APIç·¨
7. ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç·¨
8. AIç·¨
9. Honoã‚’ã‚ˆã‚Šæ·±ãçŸ¥ã‚‹
10. ãã®ä»–

# 1. è‡ªå·±ç´¹ä»‹

## è‡ªå·±ç´¹ä»‹

- å’Œç”°è£•ä»‹
- 2023å¹´4æœˆã€œ Developer Advocate @ Cloudflare
- ãƒœã‚±ã¦ co-founder
- Creator of Hono
- [https://x.com/yusukebe](https://x.com/yusukebe)
- [https://github.com/yusukebe](https://x.com/yusukebe)

### Developer Relations

- Developer GTM æ‰€å±
- Emerging Technologies & Incubation ã«è¿‘ã„ã¨ã“ã‚ã«ã„ã‚‹
- Kristianã®ãƒãƒ¼ãƒ ã®ä¸­
- Austin, Germany, Amsterdam, London, Tokyo

![DevRel](https://ss.yusukebe.com/648eda5a8d452de07e283723ca682b8adcfc2babe1451445bac2e256c518fe42_2300x1188.png)

### ã‚„ã£ã¦ã‚‹ã“ã¨

1. Honoã®é–‹ç™º
2. ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬
3. ã‚¤ãƒ™ãƒ³ãƒˆç™»å£‡
4. ãã®ä»–

### Workers Tech Talks

> Cloudflare Workersã¨ãã®å‘¨è¾ºã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’ä½¿ã†é–‹ç™ºè€…ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œè€…ã«ã‚ˆã‚‹é–‹ç™ºè€…ã®ãŸã‚ã®Workersã«ç‰¹åŒ–ã—ãŸãƒ†ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ã§ã™ã€‚

- [Cloudflare Workers Tech Talks in Tokyo #1](https://blog.yusu.ke/workers-tech-talks-1/)
- [Cloudflare Workers Tech Talks in Tokyo #2](https://blog.yusu.ke/workers-tech-talks-2/)
- [Cloudflare Workers Tech Talks in Osaka #1](https://blog.yusu.ke/workers-tech-talks-osaka-1/)
- [Cloudflare Workers Tech Talks in Tokyo #3](https://blog.yusu.ke/workers-tech-talks-3/)
- [Cloudflare Workers Tech Talks in Tokyo #4](https://blog.yusu.ke/workers-tech-talks-4/)
- [Cloudflare Workers Tech Talks in Osaka #2](https://blog.yusu.ke/workers-tech-talks-osaka-2/)
- [Cloudflare Workers Tech Talks in Tokyo #5](https://blog.yusu.ke/workers-tech-talks-5/)
- [Cloudflare Workers Tech Talks in Kyoto #1](https://blog.yusu.ke/workers-tech-talks-kyoto-1/)
- [Cloudflare Workers Tech Talks in Niigata #1](https://blog.yusu.ke/workers-tech-talks-niigata-1/)
- [Cloudflare Workers Tech Talks in Hokkaido #1](https://blog.yusu.ke/workers-tech-talks-hokkaido-1/)

#### Workers Tech Talks in Tokyo #5

![Workers Tech Talks in Tokyo 5](https://ss.yusukebe.com/44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a_2176x1218.png)

# 2. Workers ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³

## 2.1 é–‹ç™ºè€…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

- Cloudflareã«ã¯é–‹ç™ºè€…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒã‚ã‚Šã¾ã™
- Cloudflareã«ã‚ã‚‹ãŸãã•ã‚“ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ä¸€éƒ¨
- Cloudflare Workersã‚’ä¸­å¿ƒã¨ã—ãŸã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã®ç’°å¢ƒ
- å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã™ã€Œé–‹ç™ºè€…ã€å‘ã‘

![Dev Platform](https://ss.yusukebe.com/7dcd2b8894ec45b14a8d3900fbe942f6af74c020c10c3660421b488bfc9cf06e_774x430.png)

### ä½•ãŒã§ãã‚‹ã®ã‹ï¼Ÿ

- Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰
- CDNã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹ç¯‰

![Webapp](https://ss.yusukebe.com/49dce2878807866487d7c655134145d72cc631bb544845e4eb1bdc12e2b8aab5_1972x936.png)

### CDNã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

![CDN](https://ss.yusukebe.com/3f362351da2bc46b8a02290ecf454b666f9c99b6d0cf4c46a42e8fc3f87bde55_2170x904.png)

### ç‰¹å¾´

![ç‰¹å¾´](https://ss.yusukebe.com/9218d5c39470c583eaba1f9cf371e9a040c7cc90847ace1704204e74837bc4a4_1856x1034.png)

### Cloudflareã®å…¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ

![ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ](https://ss.yusukebe.com/b9441f8586ad507d1e4c6a03b79bda8b96f52d39b4f1ee605e3781b2b5a0bd0b_1888x1088.png)

### é–‹ç™ºè€…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ

![ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ](https://ss.yusukebe.com/3fd4f201e215bfe0a79dde266882c120d6ccf83b9a5e9c3ab18518c6ee5d0524_2014x914.png)

[https://developers.cloudflare.com/products/?product-group=Developer+platform](https://developers.cloudflare.com/products/?product-group=Developer+platform)

## 2.2 Cloudflare Workers

- é–‹ç™ºè€…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ™ãƒ¼ã‚¹ã«ãªã‚‹
- é–‹ç™ºè€…ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¯WorkersãŒå‰æã§ä½œã‚‰ã‚Œã¦ã„ã‚‹
- Cloudflareã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒ

> Build serverless applications and deploy instantly across the globe for exceptional performance, reliability, and scale.
>
> ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã€å“è¶Šã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ä¿¡é ¼æ€§ã€ã‚¹ã‚±ãƒ¼ãƒ«ã®ãŸã‚ã«ä¸–ç•Œä¸­ã«å³åº§ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚
>
> https://developers.cloudflare.com/workers/

- è¨­å®šã€ãƒ¡ãƒ³ãƒ†å¿…è¦ãªã—ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã‚’æä¾›
- JavaScript/Pythonã§è¨˜è¿°å¯èƒ½
- WASMã‚‚å‹•ã
- Bindingsã§å„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã«æ¥ç¶šå¯èƒ½
- Cloudflareã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å³åº§ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹
- ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³ã§ä½¿ã†ã“ã¨ãŒã§ãã‚‹
- [Workers Playground](https://workers.new) - [https://workers.new](https://workers.new)

### Cloudflare Workersã®æ€æƒ³

![SS](https://ss.yusukebe.com/4ad5531eece2c6dd3d39c00c79a70cc2a213809ace6144b16efba0d03e30b2e0_800x303.png)

- [Cloudflare Workersã®ã”ç´¹ä»‹: ã‚¨ãƒƒã‚¸ã§JavaScript Service Workersã‚’å®Ÿè¡Œã™ã‚‹](https://blog.cloudflare.com/ja-jp/introducing-cloudflare-workers-ja-jp/)
- 2017å¹´9æœˆã®è¨˜äº‹
- Cloudflareã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ å¯èƒ½ã«ã™ã‚‹
- æ¤œè¨ã—ãŸçµæœJavaScriptã«è¡Œãç€ã
- V8ã‚’æ¡ç”¨ã€è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®‰å…¨ã«å®Ÿè¡Œ
- Service Worker APIã‚’æ¡ç”¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã ãŒå®Ÿã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã«ã‚‚é©ã—ã¦ã„ã‚‹
- Web APIã¨ã—ã¦è³¢ãè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹
- ã‚³ãƒ³ãƒ†ãƒŠã§ã¯ã§ããªã„ã“ã¨ãŒã§ãã‚‹
  - ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒé€Ÿã„
  - ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãŒãªã„
  - CPUã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ãŒãªã„
  - ãƒªã‚½ãƒ¼ã‚¹ã®ãƒªãƒŸãƒƒãƒˆã‚’è€ƒãˆã‚‹å¿…è¦ãŒãªã„

![v8](https://ss.yusukebe.com/1f4b6eb1f13c4af89478337861541716493f4d387ef48b33ebb718d3a2bcbe62_982x818.png)

### Wrangler

- Workersã®ãŸã‚ã®CLI
- Workersãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤
- Pagesã§ã‚‚ä½¿ç”¨
- Bindingsã®ç®¡ç†ã‚„`tail`ãªã©ã‚‚

![SS](https://ss.yusukebe.com/0da11c72988072caed24086d59f5b21535a3bfa3a3d587079ac41f690ca91385_800x486.png)

## 2.3 Bindings

Cloudflareã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨Workersã‚’çµã¶

- KV
- Durable Objects
- R2
- D1
- Service Bindings
- Queue
- Email
- Workers AI
- Containers
- ãªã©

ä»¥ä¸‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®èª¬æ˜

### KV

- ç´ æœ´ãªAPIã‚’å‚™ãˆãŸKey-Value store
- ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚ŒãŸã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã¨é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ã«é€Ÿã„
- æ›¸ãè¾¼ã¿å¾Œã®åæ˜ ã«60ç§’ã‹ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹
- [How KV works](https://developers.cloudflare.com/workers/learning/how-kv-works/)

### Durable Objects

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’æŒã£ãŸWorkers
- ãƒãƒ£ãƒƒãƒˆãªã©ã€ãƒªã‚¢ãƒ«ã‚¢ã‚¤ãƒ ã€å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- KVã¯é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚„è¨­å®šã€DOã¯å‹•çš„ãªçŠ¶æ…‹ç®¡ç†
- [Cloudflare Durable Objects](https://developers.cloudflare.com/durable-objects/)

### R2

- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹
- ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚°ãƒ¬ã‚¹ãŒç„¡æ–™
- AWS S3ã®APIã¨äº’æ›æ€§ãŒã‚ã‚‹
- ãƒ•ãƒ­ãƒ³ãƒˆã«Workersã‚’ç½®ãã“ã¨ãŒã§ãã‚‹
- [Cloudflare R2](https://developers.cloudflare.com/r2/)

### D1

- Workersã‹ã‚‰åˆ©ç”¨å¯èƒ½ãªSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- [Cloudflare D1](https://developers.cloudflare.com/d1/)

### Service Bindings

- Workersé–“ã®é€šä¿¡å‡¦ç†ã‚’å¯èƒ½ã«ã™ã‚‹
- Publicãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’çµŒç”±ã—ãªã„
- Workersã§ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã‚‹
- [Service bindings](https://developers.cloudflare.com/workers/configuration/bindings/about-service-bindings/)

### Queue

- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€å—ä¿¡ãŒå¯èƒ½
- ã‚ªãƒ¼ãƒ—ãƒ³ãƒ™ãƒ¼ã‚¿
- `queue`ã§å—ã‘å–ã‚Š
- [Cloudflare Queues](https://developers.cloudflare.com/queues/)

### Email

- è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨
- å—ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚’å—ä¿¡ãƒœãƒƒã‚¯ã‚¹ã¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `email`ã§å—ã‘å–ã‚Š
- [Cloudflare Email Routing](https://developers.cloudflare.com/email-routing/)

## 2.4 Workersã‚’çŸ¥ã‚‹ãŸã‚ã«

### ãƒªã‚½ãƒ¼ã‚¹

- [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.cloudflare.com/workers/)
- [ãƒ–ãƒ­ã‚°](https://blog.cloudflare.com/)
- [ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://developers.cloudflare.com/workers/tutorials/)
- [Discord](https://discord.gg/cloudflaredev)
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®è¨˜äº‹

# 3. Hono ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³

## 3.1 Honoã¨ã¯?

å‰¯é¡Œ

> Fast, lightweight, built on Web Standards. Support for any JavaScript runtime.

- [https://hono.dev](https://hono.dev)
- [The story of web framework Hono, from the creator of Hono - The Cloudflare Blog](https://blog.cloudflare.com/the-story-of-web-framework-hono-from-the-creator-of-hono/)

## 3.2 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- Web APIã®ä½œæˆ
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã®ãƒ—ãƒ­ã‚­ã‚·
- CDNã®ãƒ•ãƒ­ãƒ³ãƒˆ
- ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼
- ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒª

## 3.3 ã©ã“ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ

- Nodecraft
- OpenStatus
- Unkey
- Goens
- NOT A HOTEL
- CyberAgent
- Shift
- Hanabi.rest
- BaseAI
- Mastra
- ãã®ä»–

### Who is using Hono in production?

- [https://github.com/orgs/honojs/discussions/1510](https://github.com/orgs/honojs/discussions/1510)

## 3.4 5ã¤ã®ç‰¹å¾´

- é€Ÿã„ ğŸš€ - RegExpRouterã¯ãƒã‚¸ã§é€Ÿã„ã€‚ãƒªãƒ‹ã‚¢ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã—ã¾ã›ã‚“ã€‚
- è»½é‡ ğŸª¶ - `hono/tiny`ãƒ—ãƒªã‚»ãƒƒãƒˆã¯12kBã€‚Honoã¯Web Standard APIã®ã¿ã‚’ä½¿ã£ã¦ã„ã¦ä¾å­˜0ã€‚
- ãƒãƒ«ãƒãƒ©ãƒ³ã‚¿ã‚¤ãƒ  ğŸŒ - Cloudflare Workers, Fastly Compute, Deno, Bun, AWS Lambda, or Node.jsã€‚åŒã˜ã‚³ãƒ¼ãƒ‰ãŒå…¨ã¦ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ /ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§å‹•ãã¾ã™ã€‚
- æƒã£ã¦ã„ã‚‹ ğŸ”‹ - Honoã«ã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€3rdãƒ‘ãƒ¼ãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒã‚ã‚Šã¾ã™ã€‚ã‚„ã‚ŠãŸã„ã“ã¨ãŒæƒã£ã¦ã„ã¾ã™ã€‚
- æ¥½ã—ã„DX ğŸ› ï¸ - ç¶ºéº—ãªAPIã€‚ãã—ã¦TypeScriptã®ã‚µãƒãƒ¼ãƒˆã€‚ãã†å‹ãŒã‚ã‚‹ã®ã§ã™ã€‚

## 3.5 é€Ÿã„

- 5ã¤ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’å‚™ãˆã¦ã„ã‚‹
- RegExpRouter - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã²ã¨ã¤ã®å¤§ããªæ­£è¦è¡¨ç¾ã«ã™ã‚‹ã€‚JavaScriptç•Œã§ã»ã¼æœ€é€Ÿ
- TriRouter - Trieæœ¨ã‚’åˆ©ç”¨ã€‚ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹å®Ÿè£…
- SmartRouter - ç™»éŒ²ã•ã‚ŒãŸãƒ«ãƒ¼ã‚¿ãƒ¼ã®ä¸­ã‹ã‚‰æœ€é©ãªãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’è‡ªå‹•çš„ã«é¸ã¶
- LinearRouter - ç™»éŒ²ãŒæœ€é€Ÿ
- PatternRouter - ä¸€ç•ªã‚µã‚¤ã‚ºãŒå°ã•ã„ã€‚1.3KB

### RegExpRouter

- RegExpRouterã¯ã€ŒRegExpã€ã¨ã„ã£ã¦ã‚‚Expressãªã©ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹[path-to-regexp](https://github.com/pillarjs/path-to-regexp)ã¨ã¯é•ã†
- path-to-regexpã¯ãƒªãƒ‹ã‚¢ã«ãƒãƒƒãƒã•ã›ã‚‹ã®ã§ã€ãƒ«ãƒ¼ãƒˆã”ã¨ã«æ­£è¦è¡¨ç¾ãŒèµ°ã‚‹

![SS](https://hono.dev/images/router-linear.jpg)

- RegExpRouterã¯äºˆã‚ä¸€ã¤ã®å¤§ããªæ­£è¦è¡¨ç¾ã‚’ä½œã‚Šä¸€åº¦ã§ãƒãƒƒãƒã•ã›ã‚‹

![SS](https://hono.dev/images/router-regexp.jpg)

### TriRouter

- Trieæœ¨ã®æ§‹é€ ã‚’ä½¿ã£ãŸãƒ«ãƒ¼ã‚¿ãƒ¼
- ãƒªãƒ‹ã‚¢ã«ãƒãƒƒãƒã•ã›ã‚‹ã‚ˆã‚Šé€Ÿã„ãŒã€Honoã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®éƒ½åˆä¸Šã€ä¸€èˆ¬çš„ãªæœ¨æ§‹é€ ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã¨æ¯”ã¹ã‚‹ã¨é…ã„
- ã“ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’æ­£ã¨ã™ã‚‹ã€ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹å®Ÿè£…ã«ãªã£ã¦ã„ã‚‹

![SS](https://hono.dev/images/router-tree.jpg)

### SmartRouter

- è¤‡æ•°ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ç™»éŒ²ã—ã¦ãŠãã¨ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æœ€é©ãªãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’é¸ã‚“ã§ãã‚Œã‚’ä½¿ã„ç¶šã‘ã‚‹

```ts
readonly defaultRouter: Router = new SmartRouter({
  routers: [new RegExpRouter(), new TrieRouter()],
})
```

### LinearRouter

- ç™»éŒ²ãŒé€Ÿã„

```txt
â€¢ GET /user/lookup/username/hey
----------------------------------------------------- -----------------------------
LinearRouter     1.82 Âµs/iter      (1.7 Âµs â€¦ 2.04 Âµs)   1.84 Âµs   2.04 Âµs   2.04 Âµs
MedleyRouter     4.44 Âµs/iter     (4.34 Âµs â€¦ 4.54 Âµs)   4.48 Âµs   4.54 Âµs   4.54 Âµs
FindMyWay       60.36 Âµs/iter      (45.5 Âµs â€¦ 1.9 ms)  59.88 Âµs  78.13 Âµs  82.92 Âµs
KoaTreeRouter    3.81 Âµs/iter     (3.73 Âµs â€¦ 3.87 Âµs)   3.84 Âµs   3.87 Âµs   3.87 Âµs
TrekRouter       5.84 Âµs/iter     (5.75 Âµs â€¦ 6.04 Âµs)   5.86 Âµs   6.04 Âµs   6.04 Âµs

summary for GET /user/lookup/username/hey
  LinearRouter
   2.1x faster than KoaTreeRouter
   2.45x faster than MedleyRouter
   3.21x faster than TrekRouter
   33.24x faster than FindMyWay
```

### PatternRouter

- ã¨ã«ã‹ãå°ã•ã„

![SS](https://ss.yusukebe.com/b4a1395baf72b62eb4b904c1cc1b140f3479b8a64a209740b9f51c77b3834d30_800x276.png)

### ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

- https://github.com/honojs/hono/tree/main/benchmarks/routers

å¯¾è±¡ã®ãƒ«ãƒ¼ã‚¿ãƒ¼

- [find-my-way](https://github.com/delvedor/find-my-way)
- [express](https://www.npmjs.com/package/express)
- [koa-router](https://github.com/alexmingoia/koa-router)
- [koa-tree-router](https://github.com/steambap/koa-tree-router)
- [trek-router](https://www.npmjs.com/package/trek-router)
- [@medley/router](https://www.npmjs.com/package/@medley/router)
- [Memoirist](https://github.com/saltyaom/memoirist)
- [Hono RegExpRouter](https://github.com/honojs/hono)
- [Hono TrieRouter](https://github.com/honojs/hono)

çµæœ

```txt
â€¢ all together
---------------------------------------------------------------------------- -----------------------------
Hono RegExpRouter                      460.6 ns/iter (429.69 ns â€¦ 525.88 ns)  479.5 ns 520.63 ns 525.88 ns
Hono TrieRouter                         1.52 Âµs/iter     (1.39 Âµs â€¦ 1.73 Âµs)   1.56 Âµs   1.73 Âµs   1.73 Âµs
@medley/router                        618.21 ns/iter (591.08 ns â€¦ 764.25 ns) 636.08 ns 764.25 ns 764.25 ns
find-my-way                           959.15 ns/iter   (892.79 ns â€¦ 1.02 Âµs) 979.02 ns   1.02 Âµs   1.02 Âµs
koa-tree-router                       926.79 ns/iter   (866.17 ns â€¦ 1.04 Âµs) 943.57 ns   1.04 Âµs   1.04 Âµs
trek-router                             1.76 Âµs/iter     (1.69 Âµs â€¦ 1.84 Âµs)   1.79 Âµs   1.84 Âµs   1.84 Âµs
express (WARNING: includes handling)    4.02 Âµs/iter      (3.9 Âµs â€¦ 4.33 Âµs)   4.06 Âµs   4.33 Âµs   4.33 Âµs
koa-router                              1.39 Âµs/iter     (1.34 Âµs â€¦ 1.57 Âµs)   1.41 Âµs   1.57 Âµs   1.57 Âµs
radix3                                763.26 ns/iter (734.77 ns â€¦ 902.52 ns)  781.2 ns 902.52 ns 902.52 ns
Memoirist                             540.11 ns/iter (507.38 ns â€¦ 699.65 ns) 554.52 ns 697.25 ns 699.65 ns

summary for all together
  Hono RegExpRouter
   1.17x faster than Memoirist
   1.34x faster than @medley/router
   1.66x faster than radix3
   2.01x faster than koa-tree-router
   2.08x faster than find-my-way
   3.02x faster than koa-router
   3.3x faster than Hono TrieRouter
   3.82x faster than trek-router
   8.74x faster than express (WARNING: includes handling)
```

### @usualomaã•ã‚“

RegExpRouter, SmartRouter, LinearRouter, PatternRouterã¯ [@usualomaã•ã‚“](https://github.com/usualoma) ãŒä½œã‚Šã¾ã—ãŸã€‚
@usualomaã•ã‚“ãŒç™ºè¡¨ã—ãŸè³‡æ–™ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

[![SS](https://ss.yusukebe.com/3d83d51c90264dee2d949cfeec7d1d5739f96adca5519fb8fc64d39546365536_800x437.png)](https://speakerdeck.com/usualoma/honono3-plus-1norutatosokonitunagaruprgapuroziekutonimotarasitamono)

- [Honoã®3+1ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã¨ãã“ã«ã¤ãªãŒã‚‹PRãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚ãŸã‚‰ã—ãŸã‚‚ã® - Speaker Deck](https://speakerdeck.com/usualoma/honono3-plus-1norutatosokonitunagaruprgapuroziekutonimotarasitamono)

## 3.6 è»½é‡

- æ¨™æº–ã§21KBã€PatternRouterã§13KB
- ã¡ãªã¿ã«Expressã¯572KB
- Web Standardã®APIã®ã¿ã‚’ä½¿ã£ã¦ã„ã¦ã€å¤–éƒ¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ä¾å­˜ãŒ0ã€‚

### ãƒ—ãƒªã‚»ãƒƒãƒˆ

ã‚ã‚‰ã‹ã˜ã‚ã€ãŠã™ã™ã‚ã®ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚’ãƒ—ãƒªã‚»ãƒƒãƒˆã¨ã—ã¦æä¾›ã—ã¦ã„ã‚‹ã€‚

> - `hono`:
>   ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç™»éŒ²ãŒ`hono/quick`ã‚ˆã‚Šé…ã„ã¨ã¯ã„ãˆã€ä¸€åº¦ç™»éŒ²ã•ã‚Œã‚Œã°é«˜ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç™ºæ®ã—ã¾ã™ã€‚**Deno**ã‚„**Bun**ã€ãã‚Œã«**Node.js**ãªã©ã‚’ä½¿ã£ãŸå¸¸é§å‹ã®ã‚µãƒ¼ãƒãƒ¼ã«ã¯æœ€é©ã§ã™ã€‚ã¾ãŸã€**Cloudflare Workers**ã‚„**Deno Deploy**ã§ã‚‚ã“ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ãˆã°ã„ã„ã§ã—ã‚‡ã†ã€‚ã¨ã„ã†ã®ã‚‚ã“ã‚Œã‚‰ã®ã‚ˆã†ãªv8 isolateã‚’ä½¿ã£ãŸç’°å¢ƒã§ã¯ã€isolateã¯èµ·å‹•å¾Œã—ã°ã‚‰ãè¡Œãç¶šã‘ã‚‹ã‹ã‚‰ã§ã™ï¼ˆæ™‚é–“ãŒæ±ºã¾ã£ã¦ã„ãŸã‚Šã€ãƒ¡ãƒ¢ãƒªãªã©ã®çŠ¶æ³ã«å¿œã˜ã¦å¤‰åŒ–ã—ãŸã‚Šã—ã¾ã™ï¼‰ã€‚
> - `hono/quick`:
>   ã“ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãŸã³ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ã‚ˆã†ãªç’°å¢ƒã«é©ã—ã¦ã„ã¾ã™ã€‚
> - `hono/tiny`:
>   ã“ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã¯ä¸€ç•ªãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®å°ã•ã„ãƒ—ãƒªã‚»ãƒƒãƒˆã§ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ãŒé™ã‚‰ã‚Œã¦ã„ã‚‹ç’°å¢ƒã«ã¯ã„ã„ã§ã—ã‚‡ã†ã€‚

## 3.7 ã©ã“ã§ã‚‚å‹•ã

### Web Standard APIs

- Webæ¨™æº–ã®APIã®ã¿ã‚’ä½¿ç”¨
- Node.jsã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã¯Node.jsã®incoming/outgoingã‚’Request/Responseã«å¤‰æ›ã—ã¦ã„ã‚‹
- [WinterCG](https://wintercg.org/)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹

### æœ€ä½é™ã®ã‚³ãƒ¼ãƒ‰

```ts
export default {
  async fetch() {
    return new Response('Hello World')
  },
}
```

#### ã‚ˆãä½¿ã†API

- `Request`
- `Response`
- `URL`
- `URLSearchParams`
- `Headers`
- `FormData`
- [Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API)

### ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯13ç¨®é¡

1. aws-lambda
2. bun
3. cloudflare-pages
4. cloudflare-workers
5. cloudflare-workers+vite
6. deno
7. fastly
8. lambda-edge
9. netlify
10. nextjs
11. nodejs
12. vercel
13. x-basic

### CIã§ã¯9ç¨®é¡ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒ†ã‚¹ãƒˆãŒèµ°ã‚‹

![CI](https://ss.yusukebe.com/44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a_1334x1080.png)

### ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆãŒé•ã†ã ã‘

#### Cloudflare Workers & Bun & Vercel

```ts
import { Hono } from 'hono'
const app = new Hono()

app.get('/', (c) => c.text('Hello Hono!'))

export default app
```

#### Fastly Compute

```ts
import { Hono } from 'hono'
import { fire } from '@fastly/hono-fastly-compute'

const app = new Hono()

app.get('/', (c) => c.text('Hello Fastly!'))

fire(app)
```

#### Deno

```ts
import { Hono } from '@hono/hono'

const app = new Hono()

app.get('/', (c) => c.text('Hello Hono!'))

Deno.serve(app.fetch)
```

#### Netlify

```ts
import { Hono } from 'jsr:@hono/hono'
import { handle } from 'jsr:@hono/hono/netlify'

const app = new Hono()

app.get('/', (c) => {
  return c.text('Hello Hono!')
})

export default handle(app)
```

#### AWS Lambda

```ts
import { Hono } from 'hono'
import { handle } from 'hono/aws-lambda'

const app = new Hono()

app.get('/', (c) => c.text('Hello Hono!'))

export const handler = handle(app)
```

#### Lambda@Edge

```ts
import { Hono } from 'hono'
import { handle } from 'hono/lambda-edge'

const app = new Hono()

app.get('/', (c) => c.text('Hello Hono!'))

export const handler = handle(app)
```

#### Node.js

```ts
import { serve } from '@hono/node-server'
import { Hono } from 'hono'

const app = new Hono()

app.get('/', (c) => c.text('Hello Hono!'))

serve(app)
```

## 3.8 æƒã£ã¦ã„ã‚‹

ã‚³ã‚¢ã¯å°ã•ã„ãŒã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒã‚ã‚‹ã€‚

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

- `Response`ã‚’è¿”ã™ã‚‚ã®ã‚’ã€Œãƒãƒ³ãƒ‰ãƒ©ã€ã¨å‘¼ã‚“ã§ã„ã‚‹
- ãã®å‰å¾Œã«å®Ÿè¡Œã•ã‚Œã€`Request`ã¨`Response`ã‚’æ‰±ã†ã®ãŒãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

![onion](https://hono.dev/images/onion.png)

- Honoã®ã‚¢ãƒ—ãƒªã‚’æ§‹æˆã™ã‚‹ã®ã¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ãƒãƒ³ãƒ‰ãƒ©ã ã‘

### 3ã¤ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

- ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€3rdãƒ‘ãƒ¼ãƒ†ã‚£ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒã‚ã‚‹

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ä¾‹

- [Basic Authentication](https://hono.dev/middleware/builtin/basic-auth)
- [Bearer Authentication](https://hono.dev/middleware/builtin/bearer-auth)
- [Cache](https://hono.dev/middleware/builtin/cache)
- [Compress](https://hono.dev/middleware/builtin/compress)
- [Cookie](https://hono.dev/helpers/cookie)
- [CORS](https://hono.dev/middleware/builtin/cors)
- [ETag](https://hono.dev/middleware/builtin/etag)
- [html](https://hono.dev/helpers/html)
- [JSX](https://hono.dev/guides/jsx)
- [JWT Authentication](https://hono.dev/middleware/builtin/jwt)
- [Logger](https://hono.dev/middleware/builtin/logger)
- [Pretty JSON](https://hono.dev/middleware/builtin/pretty-json)
- [Secure Headers](https://hono.dev/middleware/builtin/secure-headers)
- [GraphQL Server](https://github.com/honojs/middleware/tree/main/packages/graphql-server)
- [Firebase Authentication](https://github.com/honojs/middleware/tree/main/packages/firebase-auth)
- [Sentry](https://github.com/honojs/middleware/tree/main/packages/sentry)
- Others!

### ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

- `X-Response-Time`ãƒ˜ãƒƒãƒ€ã‚’ä»˜ä¸ã™ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

```ts
app.use('*', async (c, next) => {
  const start = Date.now()
  await next()
  const end = Date.now()
  c.res.headers.set('X-Response-Time', `${end - start}`)
})
```

### JSX

- çµ„ã¿è¾¼ã¿ã®JSXãŒä½¿ãˆã‚‹

```tsx
import type { PropsWithChildren } from 'hono/jsx'

const app = new Hono()

const Layout = (props: PropsWithChildren) => {
  return (
    <html>
      <body>{props.children}</body>
    </html>
  )
}

const Top = (props: PropsWithChildren<{ messages: string[] }>) => {
  return (
    <Layout>
      <h1>Hello Hono!</h1>
      <ul>
        {props.messages.map((message) => {
          return <li>{message}!!</li>
        })}
      </ul>
    </Layout>
  )
}

app.get('/', (c) => {
  const messages = ['Good Morning', 'Good Evening', 'Good Night']
  return c.html(<Top messages={messages} />)
})
```

## 3.8 æ¥½ã—ã„DX

### TypeScript

- Honoã§ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’TypeScriptã§æ›¸ãã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã‚‹
- Cloudflare Workersã€Denoã€Bunã¯TSã‹ã‚‰JSã¸ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã‚’æ„è­˜ã™ã‚‹å¿…è¦ãŒãªã„

![SS](https://hono.dev/images/ss.png)

### RPC

- ã‚µãƒ¼ãƒãƒ¼å´ã®å‹ã‚’å…±æœ‰ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚‚åˆ©ç”¨ã™ã‚‹ã“ã¨ã§Type-Safeã«ã™ã‚‹
- [tRPC](https://trpc.io/)ã‚ˆã‚Šã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«ä½¿ãˆã‚‹
- [Zod](https://zod.dev/)ã€[Zod Validator](https://github.com/honojs/middleware/tree/main/packages/zod-validator)ã€`hc` ã‚’ä½¿ã£ãŸã‚¹ã‚¿ãƒƒã‚¯ãŒã‚ã‚‹

#### APIã‚’æ›¸ã

```ts
import { Hono } from 'hono'

const app = new Hono()

app.get('/hello', (c) => {
  return c.json({
    message: `Hello!`,
  })
})
```

#### Zodã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã‚‹

![SC](https://hono.dev/images/sc01.gif)

```ts
import { zValidator } from '@hono/zod-validator'
import { z } from 'zod'

app.get(
  '/hello',
  zValidator(
    'query',
    z.object({
      name: z.string(),
    })
  ),
  (c) => {
    const { name } = c.req.valid('query')
    return c.json({
      message: `Hello! ${name}`,
    })
  }
)
```

#### å‹ã‚’å…±æœ‰ã™ã‚‹

- è¿”ã‚Šå€¤ã®å‹ã‚’ã¨ã‚‹

```ts
const route = app.get(
  '/hello',
  zValidator(
    'query',
    z.object({
      name: z.string(),
    })
  ),
  (c) => {
    const { name } = c.req.valid('query')
    return c.json({
      message: `Hello! ${name}`,
    })
  }
)

export type AppType = typeof route
```

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…

- `hc()` ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆ
- ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å‹ã‚’ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§æ¸¡ã™
- URLã®ãƒ‘ã‚¹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è£œå®ŒãŒåŠ¹ã

![SC](https://hono.dev/images/sc03.gif)

```ts
import { AppType } from './server'
import { hc } from 'hono/client'

const client = hc<AppType>('/api')
const res = await client.hello.$get({
  query: {
    name: 'Hono',
  },
})
```

- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯`Response`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ãã®ã¾ã¾ä½¿ãˆã‚‹
- ãŸã ã—ã€`json()`ã§å–ã‚Šå‡ºã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯å‹ãŒã¤ã

![SC](https://hono.dev/images/sc04.gif)

```ts
const data = await res.json()
console.log(`${data.message}`)
```

- APIã®å‹ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã§ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®å¤‰åŒ–ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§æ°—ã¥ãã“ã¨ã«ãªã‚‹

![SS](https://hono.dev/images/ss03.png)

### ãƒ†ã‚¹ãƒˆ

- ãƒ†ã‚¹ãƒˆãŒç°¡å˜ã«æ›¸ã‘ã‚‹

```ts
describe('Example', () => {
  test('GET /posts', async () => {
    const res = await app.request('/posts')
    expect(res.status).toBe(200)
    expect(await res.text()).toBe('Many posts')
  })
})
```

- Testing Helperã§`hc`ãŒä½¿ãˆã‚‹

![output](https://github.com/yusukebe/sonik/assets/10682/60442c8e-1640-4131-b09e-d57b6e5f350c)

```ts
import { testClient } from 'hono/testing'

it('test', async () => {
  const app = new Hono().get('/search', (c) =>
    c.json({ hello: 'world' })
  )
  const res = await testClient(app).search.$get()

  expect(await res.json()).toEqual({ hello: 'world' })
})
```

## 3.10 Cloudflare + Hono ã‚’ä½¿ã£ãŸã‚¢ãƒ—ãƒªä¾‹

### r2-image-worker

- [yusukebe/r2-image-worker](https://github.com/yusukebe/r2-image-worker)

![SC](https://user-images.githubusercontent.com/10682/167978838-b3ef2d72-81ac-4058-b161-ccb2b4f0bc16.gif)

# 4. åŸºæœ¬ç·¨

## 4.1 åˆã‚ã¦ã®Cloudflare Workers

### C3ã‚’ä½¿ã†

- Create Cloudflare CLI

```txt
npm create cloudflare@latest

Or

yarn create cloudflare

Or

pnpm create cloudflare@latest

Or

bun create cloudflare
```

### "Hello World" Worker

### `package.json`

```json
{
  "name": "01-hello-world",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "deploy": "wrangler deploy",
    "dev": "wrangler dev",
    "cf-typegen": "wrangler types"
  }
}
```

### `src/index.ts`

```ts
export default {
  async fetch(request, env, ctx): Promise<Response> {
    return new Response('Hello World!')
  },
} satisfies ExportedHandler<Env>
```

### `fetch`ã®å¼•æ•°

- `request` - `Request`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
- `env` - Bindingsã®åå‰ã¨å€¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰
- `ctx` - `ExecutionContext`ã€ã¤ã¾ã‚Š`waitUntil()`ã¨`passThroughOnException()`

### Workersã‚¢ãƒ—ãƒªã®æµã‚Œ

1. Requestã‚’å—ã‘å–ã‚‹
2. ãƒ­ã‚¸ãƒƒã‚¯
3. Responseã‚’ä½œã‚‹
4. Responseã‚’è¿”ã™

### `waitUntil()`

```ts
export default {
  async fetch(request, env, ctx): Promise<Response> {
    const log = async () => console.log('Foo')
    ctx.waitUntil(log())
    return new Response('Hello World!')
  },
} satisfies ExportedHandler<Env>
```

## 4.2 åˆã‚ã¦ã®Hono

### `create hono`

```txt
npm create hono@latest

Or

yarn create hono

Or

pnpm create hono@latest

Or

bun create hono
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™

```ts
app.get('/', (c) => {
  return c.text('Hello!')
})

app.get('/json', (c) => {
  return c.json({
    message: 'Hello!',
  })
})

app.get('/html', (c) => {
  return c.json({
    message: '<h1>Hello!</h1>',
  })
})

app.get('/stream', (c) => {
  return c.streamText(async (stream) => {
    stream.sleep(1000)
    stream.writeln('Hello!')
  })
})
```

Contextã‚’é€šã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½œã‚‹

```ts
app.get('/welcome', (c) => {
  // Set headers
  c.header('X-Message', 'Hello!')
  c.header('Content-Type', 'text/plain')

  // Set HTTP status code
  c.status(201)

  // Return the response body
  return c.body('Thank you for coming')
})
```

ä»¥ä¸‹ã¨åŒã˜

```ts
new Response('Thank you for coming', {
  status: 201,
  headers: {
    'X-Message': 'Hello',
    'Content-Type': 'text/plain',
  },
})
```

ãã®ä»–

- `c.notFound()`
- `c.redirect()`

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```ts
// HTTP Methods
app.get('/', (c) => c.text('GET /'))
app.post('/', (c) => c.text('POST /'))
app.put('/', (c) => c.text('PUT /'))
app.delete('/', (c) => c.text('DELETE /'))

// Wildcard
app.get('/wild/*/card', (c) => {
  return c.text('GET /wild/*/card')
})

// Any HTTP methods
app.all('/hello', (c) => c.text('Any Method /hello'))

// Custom HTTP method
app.on('PURGE', '/cache', (c) => c.text('PURGE Method /cache'))

// Multiple Method
app.on(['PUT', 'DELETE'], '/post', (c) => c.text('PUT or DELETE /post'))

// Path parameters
app.get('/user/:name', (c) => {
  const name = c.req.param('name')
  ...
})

// Optional parameters
// Will match `/api/animal` and `/api/animal/:type`
app.get('/api/animal/:type?', (c) => c.text('Animal!'))

// Regexp
app.get('/post/:date{[0-9]+}/:title{[a-z]+}', (c) => {
  const { date, title } = c.req.param()
  ...
})

// Including a slash
app.get('/posts/:filename{.+.png$}', (c) => {
  //...
})

// Chained routes
app
  .get('/endpoint', (c) => {
    return c.text('GET /endpoint')
  })
  .post((c) => {
    return c.text('POST /endpoint')
  })
  .delete((c) => {
    return c.text('DELETE /endpoint')
  })
```

ãƒ«ãƒ¼ãƒˆã‚’åˆ†ã‘ã‚‹

```ts
const book = new Hono()

book.get('/', (c) => c.text('List Books')) // GET /book
book.get('/:id', (c) => {
  // GET /book/:id
  const id = c.req.param('id')
  return c.text('Get Book: ' + id)
})
book.post('/', (c) => c.text('Create Book')) // POST /book

const app = new Hono()
app.route('/book', book)
```

ãƒ›ã‚¹ãƒˆåã§ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```ts
const app = new Hono({
  getPath: (req) => req.url.replace(/^https?:\/(.+?)$/, '$1'),
})

app.get('/www1.example.com/hello', (c) => c.text('hello www1'))
app.get('/www2.example.com/hello', (c) => c.text('hello www2'))
```

### Context

Bindingsã®å–å¾—

```ts
// Environment object for Cloudflare Workers
app.get('*', async c => {
  const counter = c.env.COUNTER
  ...
})
```

`c.set()` / `c.get()`

```ts
app.use('*', async (c, next) => {
  c.set('message', 'Hono is cool!!')
  await next()
})

app.get('/', (c) => {
  const message = c.get('message')
  return c.text(`The message is "${message}"`)
})
```

`Variable`ã‚’`app`ã¸æ¸¡ã™ã“ã¨ã§å‹ãŒã¤ã

```ts
type Variables = {
  message: string
}

const app = new Hono<{ Variables: Variables }>()
```

`c.var`

`c.set()`ã§ã‚»ãƒƒãƒˆã—ãŸå¤‰æ•°ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

```ts
const result = c.var.client.oneMethod()
```

ãã®ä»–

- `c.executionCtx`
- `c.event`
- `c.error`

### HonoRequest

- `param()`
- `query()`
- `queries()`
- `header()`
- `parseBody()`
- `json()`
- `text()`
- `arrayBuffer()`
- `valid()`
- `path`
- `url`
- `method`
- `raw`

# 5. ãƒ—ãƒ­ã‚­ã‚·ç·¨

[Cloudflare Workersãƒ—ãƒ­ã‚­ã‚·ãƒ‘ã‚¿ãƒ¼ãƒ³](https://zenn.dev/yusukebe/articles/647aa9ba8c1550)ã‚’ã‚„ã‚‹

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ã®è¿½åŠ 

```ts
import { Hono } from 'hono'

const app = new Hono()

app.all('*', async (c) => {
  const res = await fetch(c.req.raw)
  const newResponse = new Response(res.body, res)
  newResponse.headers.set('X-Custom', 'Foo')
  return newResponse
})

export default app
```

## CORS

```ts
app.use('/api/*', cors())
```

```ts
app.use(
  '/api2/*',
  cors({
    origin: 'http://example.com',
    allowHeaders: ['X-Custom-Header', 'Upgrade-Insecure-Requests'],
    allowMethods: ['POST', 'GET', 'OPTIONS'],
    exposeHeaders: ['Content-Length', 'X-Kuma-Revision'],
    maxAge: 600,
    credentials: true,
  })
)
```

## Basicèªè¨¼

```ts
app.use(
  '/auth/*',
  basicAuth({
    username: 'yourname',
    password: 'yoursecret',
  })
)
```

Cloudflareã®Bindingsã®å¤‰æ•°ã‚’ä½¿ã†å ´åˆ

```ts
app.use('/auth/*', async (c, next) => {
  const auth = basicAuth({
    username: c.env.USERNAME,
    password: c.env.PASSWORD,
  })
  return auth(c, next)
})
```

èªè¨¼ã¯ä»¥ä¸‹ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒã‚ã‚‹

- Basicèªè¨¼
- Bearerèªè¨¼
- JWTèªè¨¼

## ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

```ts
app.get('/old/:id', async (c) => {
  const id = c.req.param('id')
  return c.redirect(`/new/${id}`)
})
```

## ã‚ªãƒªã‚¸ãƒ³ã®æŒ¯ã‚Šåˆ†ã‘

```ts
const imageHost = 'http://imagehost'
const fontHost = 'http://fonthost'

app.get('/assets/:type{(?:images|fonts)}/:filename', async (c) => {
  const { type, filename } = c.req.param()
  const hostName = type === 'images' ? imageHost : fontHost
  const url = new URL(`/${filename}`, hostName)
  return fetch(url)
})
```

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```ts
app.get(
  '/assets/*',
  cache({
    cacheName: 'my-app',
  })
)
```

## ãƒ‡ãƒã‚¤ã‚¹åˆ¥ã®æŒ™å‹•å¤‰æ›´

```ts
app.get('/pages/*', async (c) => {
  let isMobile = false
  const userAgent = c.req.header('User-Agent') || ''

  if (userAgent.match(/(iPhone|iPod|Android|Mobile)/)) {
    isMobile = true
  }

  const cache = caches.default

  const device = isMobile ? 'Mobile' : 'Desktop'
  const cacheKey = c.req.url + '-' + device

  let response = await cache.match(cacheKey)

  if (!response) {
    response = await fetch(c.req.raw)
    response = new Response(response.body, response)
    response.headers.append('Cache-Control', 's-maxage=3600')
    c.executionCtx.waitUntil(cache.put(cacheKey, response.clone()))
  }

  return response
})
```

## HTMLã‚¿ã‚°ã®ç½®æ›

HTMLRewriterã‚’ä½¿ã†

```ts
app.get('/pages/*', async (c) => {
  const OLD_URL = 'oldhost'
  const NEW_URL = 'newhost'

  class AttributeRewriter {
    constructor(attributeName) {
      this.attributeName = attributeName
    }
    element(element) {
      const attribute = element.getAttribute(this.attributeName)
      if (attribute) {
        element.setAttribute(
          this.attributeName,
          attribute.replace(OLD_URL, NEW_URL)
        )
      }
    }
  }

  const rewriter = new HTMLRewriter().on(
    'a',
    new AttributeRewriter('href')
  )

  const res = await fetch(c.req.raw)
  const contentType = res.headers.get('Content-Type')

  if (contentType.startsWith('text/html')) {
    return rewriter.transform(res)
  } else {
    return res
  }
})
```

## ãã®ä»–

- ãƒ›ãƒƒãƒˆãƒªãƒ³ã‚¯ç¦æ­¢
- 103 Early Hints
- å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- [Cloudflare Workersãƒ—ãƒ­ã‚­ã‚·ãƒ‘ã‚¿ãƒ¼ãƒ³](https://zenn.dev/yusukebe/articles/647aa9ba8c1550)

# 6. Web APIç·¨

ä»¥ä¸‹åŸºæœ¬ã‚’ã‚„ã‚‹

- JSONã‚’è¿”ã™
- å¤‰æ•°ã‚’æ‰±ã†
- D1ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†
- ãƒ­ã‚¸ãƒƒã‚¯
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## 6.1 Blog APIã‚’ã¤ãã£ã¦ã¿ã‚ˆã†

### D1ã®è¨­å®š

```txt
npx wrangler d1 create blog
npx wrangler d1 execute blog --local --file ./blog.sql
npx wrangler d1 execute blog --local --command "INSERT INTO posts(id,title,content) VALUES('1','Hello','Nice day!')"
npx wrangler d1 execute blog --local --command "SELECT * FROM posts"
```

### `wrangler.jsonc`

```json
{
  "name": "05-web-api",
  "main": "src/index.ts",
  "compatibility_date": "2025-04-16",
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "blog",
      "database_id": "xxxxxxxxxxxxxxxxxxxxxxx"
    }
  ]
}
```

```sql
CREATE TABLE posts (
  id TEXT PRIMARY KEY,
  created_at TEXT DEFAULT (datetime('now')),
  title TEXT,
  content TEXT
);
```

```txt
npm i zod @hono/zod-validator
```

### å…±é€šã§ä½¿ã†å‹

```ts
import { z } from 'zod'

export const schema = z.object({
  title: z.string().min(1),
  content: z.string().min(1),
})

type Post = z.infer<typeof schema> & {
  created_at: string
  id: string
}
```

### `GET /posts`ã®å®Ÿè£…

```ts
const { results } = await c.env.DB.prepare(
  'SELECT * FROM posts ORDER BY created_at DESC;'
).all<Post>()
```

- Bindingsã¸ã¯`c.env.DB`ã§ã‚¢ã‚¯ã‚»ã‚¹
- `all`ã¸`Post`å‹ã‚’ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§æ¸¡ã™

### `POST /posts`ã®å®Ÿè£…

Zod Validatorã‚’ä½¿ã†

```ts
import { zValidator } from '@hono/zod-validator'
// ...
app.post('/posts', zValidator('form', schema), async (c) => {
  const { title, content } = c.req.valid('form')
  // ...
})
```

UUIDã®ç”Ÿæˆ

```ts
const id = crypto.randomUUID()
```

Insertã®å®Ÿè¡Œ

```ts
const { success } = await c.env.DB.prepare(
  'INSERT INTO posts(id, title, content) values (?, ?, ?)'
)
  .bind(id, title, content)
  .run()
```

### ãƒ‡ãƒ—ãƒ­ã‚¤

```txt
npm run deploy
```

å®Ÿéš›ã¯Wranglerã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹

```txt
wrangler deploy --minify src/index.ts
```

# 7. ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ç·¨

## 7.1 Blogã®UIã‚‚ã¤ãã£ã¦ã¿ã‚ˆã†

- æ‹¡å¼µå­ã‚’`.tsx`ã«ã—ã¦JSXã‚’ä½¿ãŠã†
- ã‚·ãƒ³ãƒ—ãƒ«ãªSSRã§ã®æç”»ã‚’ã™ã‚‹

### å®Œæˆå½¢

![SS](https://ss.yusukebe.com/078500973a75457b0bd771c6aeea9c48fc308d605f7c114314a1e24235f1165e_800x535.png)

### Rendererã‚’å®šç¾©ã™ã‚‹

```tsx
import { jsxRenderer } from 'hono/jsx-renderer'

export const renderer = jsxRenderer(({ children }) => {
  return (
    <html lang='en'>
      <head>
        <meta
          name='viewport'
          content='width=device-width, initial-scale=1'
        />
        <link
          rel='stylesheet'
          href='https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css'
        />
      </head>
      <body>
        <main class='container'>
          <h1>
            <a href='/'>Blog!</a>
          </h1>
          {children}
          <div style='margin-top:2rem'>
            <small>Â© 2025 your name</small>
          </div>
        </main>
      </body>
    </html>
  )
})
```

### Rendererã‚’ä½¿ã†

```tsx
import { Hono } from 'hono'
import { renderer } from './renderer'

const app = new Hono<{ Bindings: CloudflareBindings }>()

app.use(renderer)
```

### ä¸€è¦§ã‚’HTMLã§è¡¨ç¤ºã™ã‚‹

```tsx
app.get('/', async (c) => {
  const { results: posts } = await c.env.DB.prepare(
    'SELECT * FROM posts ORDER BY created_at DESC;'
  ).all<Post>()
  return c.render(
    <div>
      <title>Blog</title>
      <form action='/' method='post'>
        <div>
          <label>Title</label>
          <input type='text' name='title' />
        </div>
        <div>
          <label>Content</label>
          <textarea name='content'></textarea>
        </div>
        <button type='submit'>Submit</button>
      </form>
      {posts.map((post) => {
        return (
          <article>
            <h2>{post.title}</h2>
            <p>{post.content}</p>
          </article>
        )
      })}
    </div>
  )
})
```

### è¨˜äº‹ã‚’ä½œã‚‹

```tsx
app.post(
  '/',
  zValidator('form', schema, (result, c) => {
    if (!result.success) {
      console.error(result.error.message)
      return c.redirect('/')
    }
  }),
  async (c) => {
    const id = crypto.randomUUID()
    const { title, content } = c.req.valid('form')

    await c.env.DB.prepare(
      'INSERT INTO posts(id, title, content) values (?, ?, ?)'
    )
      .bind(id, title, content)
      .run()

    return c.redirect('/')
  }
)
```

# 8. AIç·¨

## 8.1 ãƒªãƒ¢ãƒ¼ãƒˆMCPã‚µãƒ¼ãƒãƒ¼ã‚’ã¤ãã£ã¦ã¿ã‚ˆã†

- ãƒ–ãƒ­ã‚°ã®ä»•çµ„ã¿ã‚’ãã®ã¾ã¾ãƒªãƒ¢ãƒ¼ãƒˆMCPã«ã™ã‚‹
- [`@hono/mcp`](https://github.com/honojs/middleware/tree/main/packages/mcp)ã¨[`@modelcontextprotocol/sdk`](https://github.com/modelcontextprotocol/typescript-sdk)ã‚’ä½¿ã£ãŸèªè¨¼ãƒ¬ã‚¹ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã®è¶…ç°¡æ˜“ãªã‚‚ã®
- Cloudflareã®[Agents SDK](https://developers.cloudflare.com/agents/guides/remote-mcp-server/)ã‚‚ä½¿ãˆã‚‹
- [https://github.com/yusukebe/cloudflare-workshop-examples/tree/main/projects/07-mcp](https://github.com/yusukebe/cloudflare-workshop-examples/tree/main/projects/07-mcp)

### `@hono/mcp`ã‚’ä½¿ã†

```ts
import { Hono } from 'hono'
import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js'
import { StreamableHTTPTransport } from '@hono/mcp'

const app = new Hono<{ Bindings: CloudflareBindings }>()

app.all('/mcp', async (c) => {
  const transport = new StreamableHTTPTransport()

  const mcpServer = new McpServer({
    name: 'my-blog-mcp-server',
    version: '1.0.0',
  })

  await mcpServer.connect(transport)
  return transport.handleRequest(c)
})

export default app
```

### ãƒ„ãƒ¼ãƒ«ã®å®šç¾©

```ts
app.all('/mcp', async (c) => {
  const transport = new StreamableHTTPTransport()

  const mcpServer = new McpServer({
    name: 'my-blog-mcp-server',
    version: '1.0.0',
  })

  mcpServer.tool('get_posts', async () => {
    const { results: posts } = await c.env.DB.prepare(
      'SELECT * FROM posts ORDER BY created_at DESC;'
    ).all<Post>()
    return {
      content: [
        {
          type: 'text',
          text: JSON.stringify(posts),
        },
      ],
    }
  })

  mcpServer.tool(
    'create_post',
    { title: z.string(), content: z.string() },
    async ({ title, content }) => {
      const id = crypto.randomUUID()
      const { success } = await c.env.DB.prepare(
        'INSERT INTO posts(id, title, content) values (?, ?, ?)'
      )
        .bind(id, title, content)
        .run()
      return {
        content: [
          {
            type: 'text',
            text: JSON.stringify({ success }),
          },
        ],
      }
    }
  )

  await mcpServer.connect(transport)
  return transport.handleRequest(c)
})
```

## 8.2 Workers AIã‚’ä½¿ã£ã¦ã¿ã‚ˆã†

- æ¨è«–ãƒ¢ãƒ‡ãƒ«ã‚’å‹•ã‹ã™ã ã‘ãªã‚‰ç°¡å˜
- ãŸãã•ã‚“ã®ãƒ¢ãƒ‡ãƒ« [https://developers.cloudflare.com/workers-ai/models/](https://developers.cloudflare.com/workers-ai/models/)

## 8.3 Agents

- [https://agents.cloudflare.com/](https://agents.cloudflare.com/)
- Cloudflareä¸Šã§AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œã‚ã†
- æ–°ã—ã„ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã¨ã„ã†ã‚ˆã‚Šã‹ã€Workersã¨ãã®ä»–ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®

### ãã‚‚ãã‚‚Cloudflareã§AIã‚’ã‚„ã‚‹æ„å‘³

- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹
- Durable Objectsã§çŠ¶æ…‹ã‚’ç®¡ç†ã§ãã‚‹
- Workers AIã€Scheduleã€Workflowsãªã©ãŒã‚ã‚‹
- Agents SDKãŒã‚ã‚‹
  - ä¾‹: MCPã®èªè¨¼ã®å®Ÿè£…ã¯é¢å€’ã ãŒã€æä¾›ã—ã¦ãã‚Œã¦ã„ã‚‹
- MCPã‚µãƒ¼ãƒãƒ¼ã¸ã®å–ã‚Šçµ„ã¿
  - [æœ¬æ—¥ã‹ã‚‰ã”åˆ©ç”¨ã„ãŸã ã‘ã‚‹Cloudflareã®æ–°MCPã‚µãƒ¼ãƒãƒ¼13è£½å“](https://blog.cloudflare.com/ja-jp/thirteen-new-mcp-servers-from-cloudflare/)
  - [MCPãƒ‡ãƒ¢ãƒ»ãƒ‡ãƒ¼: å…ˆé€²çš„ãªAIä¼æ¥­10ç¤¾ãŒCloudflareä¸Šã§MCPã‚µãƒ¼ãƒãƒ¼ã‚’æ§‹ç¯‰ã—ãŸæ–¹æ³•](https://blog.cloudflare.com/ja-jp/mcp-demo-day/)

## 8.4 Sandbox SDK

- [https://sandbox.cloudflare.com/](https://sandbox.cloudflare.com/)
- éš”é›¢ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã®ç’°å¢ƒã§ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹
- AIãŒã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã®ã«ä½¿ãˆã‚‹
- ã‚ã¨ã¯CI/CDãªã©

```ts
import { getSandbox } from '@cloudflare/sandbox'

export default {
  async fetch(request: Request, env: Env): Promise<Response> {
    const sandbox = getSandbox(env.Sandbox, 'user-123')

    // Execute a command and get the result
    const result = await sandbox.exec('python --version')

    return Response.json({
      output: result.stdout,
      exitCode: result.exitCode,
      success: result.success,
    })
  },
}
```

## 8.5 x402

- [https://blog.cloudflare.com/x402/](https://blog.cloudflare.com/x402/)
- [https://developers.cloudflare.com/agents/x402/](https://developers.cloudflare.com/agents/x402/)
- Coinbaseã¨å”åŠ›ã—ã€Œx402ã€ã‚’è¨­ç«‹
- 402 Payment Requiredã‚’ä½¿ã£ã¦HTTPçµŒç”±ã§æ”¯æ‰•ã„ã™ã‚‹
- Cloudflareãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„
- ç¾åœ¨ã‚‚Workersã§å®Ÿè£…ã§ãã‚‹

### ãƒ‡ãƒ¢

- MCPã‚µãƒ¼ãƒãƒ¼ãŒx402ã‚’å®Ÿè£…ã—æ”¯æ‰•ã„ã‚’è¦æ±‚
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚‚å®Ÿè£…ã—ã¦ã‚ã‚‹
- 0.01ãƒ‰ãƒ«ã ã‘ä½¿ãˆã‚‹
- ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ä½¿ã†
- ä¸€åº¦ä½¿ã†ã¨ç„¡ä¸€æ–‡ã«ãªã‚‹ã®ã§ä½¿ãˆãªã„
- [https://playground.x402.cloudflare.com/](https://playground.x402.cloudflare.com/)

# 9. Honoã‚’ã‚ˆã‚Šæ·±ãä½¿ã†

## 9.1 ä»–ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§å‹•ã‹ã—ã¦ã¿ã‚ˆã†

1. aws-lambda
2. bun
3. cloudflare-pages
4. cloudflare-workers
5. deno
6. fastly
7. lagon
8. lambda-edge
9. netlify
10. nextjs
11. nodejs
12. vercel

## 9.2 å¤§ããªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ§‹æˆ

- `app.route()`ã§ç¹‹ã„ã§ã„ã

## 9.3 ã‚¢ãƒ€ãƒ—ãƒˆã¨ãƒã‚¦ãƒ³ãƒˆ

### `app.mount()`

- ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®ä»–ã«ãƒã‚¦ãƒ³ãƒˆã¨ã„ã†æ¦‚å¿µ
- `fetch` APIãªã‚‰ã©ã‚“ãªã‚¢ãƒ—ãƒªã‚‚ãƒã‚¦ãƒ³ãƒˆã§ãã‚‹

```ts
// Create itty-router application
const ittyRouter = IttyRouter()

// Handle `GET /itty-router/hello`
ittyRouter.get(
  '/hello',
  () => new Response('Hello from itty-router!')
)

// Hono application
const app = new Hono()

// Hono application
app.mount('/itty-router', ittyRouter.handle)
```

Honoã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«ã‚¢ãƒ€ãƒ—ãƒˆã—ã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ãƒã‚¦ãƒ³ãƒˆã™ã‚‹

![SS](https://github-production-user-asset-6210df.s3.amazonaws.com/10682/239415401-74247b3e-0e36-4bc2-9ccd-e98f99b49466.jpg)

ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯Aã¯å„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¸ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’ä½œã‚ŠãŒã¡

![SS](https://github-production-user-asset-6210df.s3.amazonaws.com/10682/239415510-d077dffb-da79-442f-803e-4c155f637b93.jpg)

ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯Aã‚’å„ç¨®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«å¯¾å¿œã•ã›ãŸã‘ã‚Œã°ã€Honoä¸Šã§å‹•ã‘ã°ã‚ˆã„

![SS](https://github-production-user-asset-6210df.s3.amazonaws.com/10682/239415546-38ed968f-69a4-4b41-baaa-5dac5cd69679.jpg)

ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã§Honoã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒä½¿ãˆã‚‹

```ts
app.use('/another-app/admin/*', basicAuth({ username, password }))
```

# 10. ãã®ä»–

- Containers
  - [https://github.com/yusukebe/image-resize-containers](https://github.com/yusukebe/image-resize-containers)
- Bindingsã®ãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦
- Vite plugins
- HonoXã«ã¤ã„ã¦

## ãŠã¾ã‘. ã“ã®è³‡æ–™ã‚‚Workersã§ã§ãã¦ã‚‹

- [https://github.com/yusukebe/cloudflare-workshop](https://github.com/yusukebe/cloudflare-workshop)

## ãƒªãƒ³ã‚¯é›†

- [https://hono.dev/](https://hono.dev/)
- [https://github.com/honojs/hono](https://github.com/honojs/hono)
- [Cloudflare Workersãƒ—ãƒ­ã‚­ã‚·ãƒ‘ã‚¿ãƒ¼ãƒ³](https://zenn.dev/yusukebe/articles/647aa9ba8c1550)
